<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Crawlers</title>
        <script type="text/javascript" src="../../../resources/libs/p5.js"></script>
    </head>

    <body style="overflow: hidden;">
        <input type="range" min="1" max="300" value="10" id="lines" onchange="setup()" class="styled">
        <p id="lines_text" class="styled"></p>
        <input type="range" min="1" max="8000" value="3000" id="curvy" onchange="change()" class="styled">
        <p id="curve_text" class="styled"></p>
        <input type="range" min="1" max="10" value="2" id="speedy" onchange="change()" class="styled">
        <p id="speed_text" class="styled"></p>
        <input type="button" onclick="setup();" id="reset" class="styled" value="Reset">
    </body>

    <style>
        body {
            margin: 0%;
        }
        
        .styled {
            background-color: #fff;
            position: absolute;
            background-color: #fff;
            position: absolute;
            font-size: 26px;
            margin: 0%;
        }
        
        .styled:focus {
            outline: none;
        }
        
        #lines {
            top: 5px;
            left: 5px;
        }
        
        #lines_text {
            user-select: none;
            top: 5px;
            left: 160px;
        }
        
        #curvy {
            top: 30px;
            left: 5px;
        }
        
        #curve_text {
            user-select: none;
            top: 30px;
            left: 160px;
        }
        
        #speedy {
            top: 55px;
            left: 5px;
        }
        
        #speed_text {
            user-select: none;
            top: 55px;
            left: 160px;
        }
        
        #reset {
            top: 80px;
            left: 5px;
        }
    </style>

    <script>
        var crawlers,
            curvyness = document.getElementById("curvy").value,
            speed = document.getElementById("speedy").value;

        function setup() {
            crawlers = [];
            var ctx = createCanvas(innerWidth, innerHeight);
            for (i = 0; i < document.getElementById("lines").value; i++) {
                crawlers[i] = new crawler();
                crawlers[i].setup();
            }
            strokeWeight(2);
        }

        function draw() {
            for (i = 0; i < crawlers.length; i++) {
                crawlers[i].update();
                crawlers[i].display();
            }
            document.getElementById("lines_text").innerHTML = "Lines: " + document.getElementById("lines").value;
            document.getElementById("curve_text").innerHTML = "Curvyness: " + document.getElementById("curvy").value;
            document.getElementById("speed_text").innerHTML = "Speed: " + document.getElementById("speedy").value;
        }

        function crawler() {
            this.x;
            this.y;
            this.last_x;
            this.last_y;
            this.step_amount;
            this.step = 0;
            this.unique;

            this.setup = function() {
                this.x = width / 2;
                this.y = height / 2;
                this.last_x = width / 2;
                this.last_y = height / 2;
                this.unique_x = sin(random(100));
                this.unique_y = sin(Math.random(100));
            }

            this.update = function() {
                this.step++;
                this.last_x = this.x;
                this.last_y = this.y;
                this.x += map(noise((millis() * this.unique_x) / (8001 - curvyness)), 0, 1, -1, 1) * speed;
                this.y += map(noise((millis() * this.unique_y) / (8001 - curvyness)), 0, 1, -1, 1) * speed;
            }

            this.display = function() {
                stroke(setColor(millis() * this.unique_x / 10000, 100));
                line(this.last_x, this.last_y, this.x, this.y);
            }
        }
        
        function change() {
            curvyness = document.getElementById("curvy").value;
            speed = document.getElementById("speedy").value;
        }

        function setColor(input, sat) {
            r = 255 - abs(sin(input) * sat);
            g = 255 - abs(sin(input + 45) * sat);
            b = 255 - abs(sin(input + 90) * sat);
            return color(r, g, b);
        }
    </script>
</html>